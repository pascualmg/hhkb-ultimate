#+TITLE: Configuración HHKB Pro QMK
#+TITLE: HHKB Ultimate QMK Setup Guide
#+AUTHOR: pascualmg
#+PROPERTY: header-args:c :tangle keymap.c
#+PROPERTY: header-args:shell :results output

* The Ultimate HHKB Experience
This guide documents the installation of a custom HHKB keymap that combines three legendary elements:
- The timeless HHKB layout by Eiiti Wada
- Hasu's revolutionary mouse control layer
- The efficiency of SpaceFN

The result is a zero-compromise configuration that enhances the HHKB while preserving its philosophical purity.

* Pre-requisites

** Hardware Required
- HHKB Professional (any version)
- USB cable
- Hasu Controller

** Software Required
Choose your preferred environment:

*** Nix Environment (Recommended)
The cleanest and most reliable setup:
#+BEGIN_SRC shell
# Enter a shell with QMK tools
nix-shell -p qmk
#+END_SRC

*** Traditional Setup
If you prefer the traditional approach:
#+BEGIN_SRC shell
# Clone QMK Firmware repository
git clone https://github.com/qmk/qmk_firmware.git
cd qmk_firmware

# Install dependencies
util/qmk_install.sh  # For Linux/macOS users
#+END_SRC

* Installation Steps
** pro-tip
This file is an .org!! if you use emacs you can tangle the code and use it directly in your qmk_firmware folder and use literate programming to document your keymap.

** 1. Prepare Your Directory
Create a dedicated space for your custom keymap:
#+BEGIN_SRC shell
# Create the keymap directory
mkdir -p keyboards/hhkb/ansi/32u4/keymaps/ultimate
cd keyboards/hhkb/ansi/32u4/keymaps/ultimate
#+END_SRC

** 2. Create Required Files

*** rules.mk
This enables the necessary QMK features:
#+BEGIN_SRC makefile :tangle rules.mk
MOUSEKEY_ENABLE = yes    # Mouse keys
EXTRAKEY_ENABLE = yes    # Audio control and System control
COMMAND_ENABLE = yes     # Commands for debug and configuration
NKRO_ENABLE = yes       # USB Nkey Rollover
#+END_SRC

*** keymap.c
The heart of the configuration. Copy our complete keymap here.
The file includes:
- Base HHKB layer
- Function layer with media controls
- Mouse control layer (activated by holding ;)
- VI-style navigation (activated by holding /)
- SpaceFN layer for quick access to function keys

** 3. Building the Firmware
Compile your custom firmware:
#+BEGIN_SRC shell
# Compile the keymap
qmk compile -kb hhkb/ansi/32u4 -km ultimate
#+END_SRC

** 4. Flashing Instructions
1. Remove the HHKB's back cover
2. Locate the reset button (small button near the USB port)
3. Connect your HHKB to your computer
4. Press the reset button
5. Flash the firmware:
#+BEGIN_SRC shell
qmk flash -kb hhkb/ansi/32u4 -km ultimate
#+END_SRC

* Layout Guide

** Available Layers
| Layer  | Activation    | Primary Use                    |
|--------+---------------+--------------------------------|
| Base   | Default       | Standard HHKB typing           |
| Fn     | Fn key        | Media & function keys          |
| Mouse  | Hold ;        | Complete mouse control         |
| VI     | Hold /        | Efficient navigation           |
| SpaceFN| Hold Space    | Quick access to function keys  |

** Special Features
- Full mouse control without leaving the home row
- VI-style navigation for efficient text editing
- One-handed F-key access via SpaceFN
- All HHKB standard functions preserved

* Customization
The keymap is designed to be built upon. Common customizations include:
- Adjusting mouse movement speed
- Changing layer activation keys
- Adding new layers
- Creating custom macros

* Credits & References
- Eiiti Wada for the HHKB design philosophy
- Hasu for the alternate controller and mouse layer concept
- QMK Documentation: https://docs.qmk.fm/
- Hasu's Thread: https://geekhack.org/index.php?topic=12047.0

* Keymap
Your keymap.c content goes here for org-babel-tangle.
#+begin_src c :tangle keymap.c
/*
  ██╗  ██╗██╗  ██╗██╗  ██╗██████╗     ██╗   ██╗██╗  ████████╗██╗███╗   ███╗ █████╗ ████████╗███████╗
  ██║  ██║██║  ██║██║ ██╔╝██╔══██╗    ██║   ██║██║  ╚══██╔══╝██║████╗ ████║██╔══██╗╚══██╔══╝██╔════╝
  ███████║███████║█████╔╝ ██████╔╝    ██║   ██║██║     ██║   ██║██╔████╔██║███████║   ██║   █████╗
  ██╔══██║██╔══██║██╔═██╗ ██╔══██╗    ██║   ██║██║     ██║   ██║██║╚██╔╝██║██╔══██║   ██║   ██╔══╝
  ██║  ██║██║  ██║██║  ██╗██████╔╝    ╚██████╔╝███████╗██║   ██║██║ ╚═╝ ██║██║  ██║   ██║   ███████╗
  ╚═╝  ╚═╝╚═╝  ╚═╝╚═╝  ╚═╝╚═════╝      ╚═════╝ ╚══════╝╚═╝   ╚═╝╚═╝     ╚═╝╚═╝  ╚═╝   ╚═╝   ╚══════╝
 ,*
 ,* 📜 The Wisdom of the Masters 📜
 ,*
 ,* 「キーボードは馬のような物です。
 ,*  乗りこなすまでは大変だけど、
 ,*  乗りこなしてしまえば、
 ,*  意のままに操れる道具になります。」
 ,*                     - 和田英一 (Eiiti Wada)
 ,*
 ,* "A keyboard is like a horse.
 ,*  It's hard to master at first,
 ,*  but once you do master it,
 ,*  it becomes a tool you can control at will."
 ,*                     - Eiiti Wada, HHKB Creator
 ,*
 ,* 🌟 About This Keymap 🌟
 ,*
 ,* This keymap is a tribute to the HHKB community and especially to Hasu,
 ,* whose amazing work with the alternate controller and direct help in the forums
 ,* made this configuration possible. It combines the timeless design of the HHKB
 ,* with modern features that enhance its legendary capabilities.
 ,*
 ,* ⚡ Special Thanks:
 ,* - Eiiti Wada for creating the perfect keyboard
 ,* - Hasu for the alternate controller and personal help in the forums
 ,* - The mechanical keyboard community for endless inspiration
 ,*
 ,* 【❂ Features ❂】
 ,* ◈ Original HHKB layout preserved in its pure form
 ,* ◈ Hasu's legendary mouse and VI navigation layers
 ,* ◈ SpaceFN layer for lightning-fast access to F-keys
 ,* ◈ Zero-compromise implementation
 ,*
 ,* As Hasu taught us in the forums: powerful features don't need to
 ,* compromise the HHKB's elegant simplicity.
 ,*/

#include QMK_KEYBOARD_H

// Layer definitions
enum layers {
    BASE   = 0, // HHKB Base layer
    FN     = 1, // HHKB Fn layer
    MOUSE  = 2, // Mouse control (semicolon)
    VI     = 3, // VI navigation (slash)
    SPACEF = 4  // SpaceFN layer (space)
};

const uint16_t PROGMEM keymaps[][MATRIX_ROWS][MATRIX_COLS] = {
    /* Layer 0: Default Layer
     ,* ,-----------------------------------------------------------.
     ,* |Esc|  1|  2|  3|  4|  5|  6|  7|  8|  9|  0|  -|  =|  \|  `|
     ,* |-----------------------------------------------------------|
     ,* |Tab  |  Q|  W|  E|  R|  T|  Y|  U|  I|  O|  P|  [|  ]|Backs|
     ,* |-----------------------------------------------------------|
     ,* |Contro|  A|  S|  D|  F|  G|  H|  J|  K|  L|  ;*|  '|Enter |
     ,* |-----------------------------------------------------------|
     ,* |Shift   |  Z|  X|  C|  V|  B|  N|  M|  ,|  .|  /*|Shift|Fn|
     ,* `-----------------------------------------------------------'
     ,*       |Alt|Gui  |         Space*        |Gui  |Alt|
     ,*       `-------------------------------------------'
     ,* * ; = Hold for Mouse Layer
     ,* * / = Hold for VI Layer
     ,* * Space = Hold for SpaceFN Layer
     ,*/
    [BASE] = LAYOUT(
        KC_ESC,  KC_1,    KC_2,    KC_3,    KC_4,    KC_5,    KC_6,    KC_7,    KC_8,    KC_9,    KC_0,    KC_MINS, KC_EQL,  KC_BSLS, KC_GRV,
        KC_TAB,  KC_Q,    KC_W,    KC_E,    KC_R,    KC_T,    KC_Y,    KC_U,    KC_I,    KC_O,    KC_P,    KC_LBRC, KC_RBRC, KC_BSPC,
        KC_LCTL, KC_A,    KC_S,    KC_D,    KC_F,    KC_G,    KC_H,    KC_J,    KC_K,    KC_L,    LT(MOUSE,KC_SCLN), KC_QUOT, KC_ENT,
        KC_LSFT, KC_Z,    KC_X,    KC_C,    KC_V,    KC_B,    KC_N,    KC_M,    KC_COMM, KC_DOT,  LT(VI,KC_SLSH), KC_RSFT, MO(FN),
        KC_LALT, KC_LGUI,                            LT(SPACEF,KC_SPC),                                      KC_RGUI, KC_RALT),

    /* Layer 1: HHKB Fn Layer - System & Media Controls
     ,* ,-----------------------------------------------------------.
     ,* |Pwr| F1| F2| F3| F4| F5| F6| F7| F8| F9|F10|F11|F12|Ins|Del|
     ,* |-----------------------------------------------------------|
     ,* |Caps |   |   |   |   |   |   |   |PSc|SLk|Pus|Up |   |     |
     ,* |-----------------------------------------------------------|
     ,* |      |VoD|VoU|Mut|   |   |  *|  /|Hom|PgU|Lef|Rig|Enter   |
     ,* |-----------------------------------------------------------|
     ,* |        |   |   |   |   |   |  +|  -|End|PgD|Dow|      |   |
     ,* `-----------------------------------------------------------'
     ,* Classic HHKB function layer with all standard controls
     ,*/
    [FN] = LAYOUT(
        KC_PWR,  KC_F1,   KC_F2,   KC_F3,   KC_F4,   KC_F5,   KC_F6,   KC_F7,   KC_F8,   KC_F9,   KC_F10,  KC_F11,  KC_F12,  KC_INS,  KC_DEL,
        KC_CAPS, KC_TRNS, KC_TRNS, KC_TRNS, KC_TRNS, KC_TRNS, KC_TRNS, KC_TRNS, KC_PSCR, KC_SCRL, KC_PAUS, KC_UP,   KC_TRNS, KC_TRNS,
        KC_TRNS, KC_VOLD, KC_VOLU, KC_MUTE, KC_TRNS, KC_TRNS, KC_PAST, KC_PSLS, KC_HOME, KC_PGUP, KC_LEFT, KC_RGHT, KC_PENT,
        KC_TRNS, KC_TRNS, KC_TRNS, KC_TRNS, KC_TRNS, KC_TRNS, KC_PPLS, KC_PMNS, KC_END,  KC_PGDN, KC_DOWN, KC_TRNS, KC_TRNS,
        KC_TRNS, KC_TRNS,                            KC_TRNS,                                                KC_TRNS, KC_TRNS),

    /* Layer 2: Mouse Mode [Hold ;] - Full Mouse Control
     ,* ,-----------------------------------------------------------.
     ,* |   | F1| F2| F3| F4| F5| F6| F7| F8| F9|F10|F11|F12|   |   |
     ,* |-----------------------------------------------------------|
     ,* |     |   |   |   |   |   |WhL|WhD|MsU|WhU|WhR|M4 |M5 |     |
     ,* |-----------------------------------------------------------|
     ,* |      |Ac0|Ac1|Ac2|   |   |   |MsL|MsD|MsR|   |   |Enter   |
     ,* |-----------------------------------------------------------|
     ,* |        |   |   |   |   |M3 |M2 |M1 |M4 |M5 |   |      |   |
     ,* `-----------------------------------------------------------'
     ,* Mx  = Mouse Button x    | WhX = Wheel X
     ,* MsX = Mouse Motion X    | AcX = Acceleration X
     ,*
     ,* Inspired by Hasu's original mouse control layer
     ,*/
    [MOUSE] = LAYOUT(
        KC_GRV,  KC_F1,   KC_F2,   KC_F3,   KC_F4,   KC_F5,   KC_F6,   KC_F7,   KC_F8,   KC_F9,   KC_F10,  KC_F11,  KC_F12,  KC_INS,  KC_DEL,
        KC_TAB,  KC_TRNS, KC_TRNS, KC_TRNS, KC_TRNS, KC_TRNS, KC_WH_L, KC_WH_D, KC_MS_U, KC_WH_U, KC_WH_R, KC_BTN4, KC_BTN5, KC_TRNS,
        KC_LCTL, KC_ACL0, KC_ACL1, KC_ACL2, KC_TRNS, KC_TRNS, KC_TRNS, KC_MS_L, KC_MS_D, KC_MS_R, KC_TRNS, KC_TRNS, KC_ENT,
        KC_LSFT, KC_TRNS, KC_TRNS, KC_TRNS, KC_TRNS, KC_BTN3, KC_BTN2, KC_BTN1, KC_BTN4, KC_BTN5, KC_TRNS, KC_RSFT, KC_TRNS,
        KC_LGUI, KC_LALT,                            KC_BTN1,                                                KC_TRNS, KC_TRNS),

    /* Layer 3: Vi Mode [Hold /] - Advanced Navigation
     ,* ,-----------------------------------------------------------.
     ,* |   | F1| F2| F3| F4| F5| F6| F7| F8| F9|F10|F11|F12|   |   |
     ,* |-----------------------------------------------------------|
     ,* |     |Hom|PgD|Up |PgU|End|Hom|PgD|PgU|End|   |   |   |     |
     ,* |-----------------------------------------------------------|
     ,* |      |   |Lef|Dow|Rig|   |Lef|Dow|Up |Rig|   |   |Enter   |
     ,* |-----------------------------------------------------------|
     ,* |        |   |   |   |   |   |Hom|PgD|PgU|End|   |      |   |
     ,* `-----------------------------------------------------------'
     ,*
     ,* Hasu's VI-inspired navigation layer
     ,* Quick movement without leaving the home row
     ,*/
    [VI] = LAYOUT(
        KC_GRV,  KC_F1,   KC_F2,   KC_F3,   KC_F4,   KC_F5,   KC_F6,   KC_F7,   KC_F8,   KC_F9,   KC_F10,  KC_F11,  KC_F12,  KC_INS,  KC_DEL,
        KC_TAB,  KC_HOME, KC_PGDN, KC_UP,   KC_PGUP, KC_END,  KC_HOME, KC_PGDN, KC_PGUP, KC_END,  KC_TRNS, KC_TRNS, KC_TRNS, KC_TRNS,
        KC_LCTL, KC_TRNS, KC_LEFT, KC_DOWN, KC_RGHT, KC_TRNS, KC_LEFT, KC_DOWN, KC_UP,   KC_RGHT, KC_TRNS, KC_TRNS, KC_ENT,
        KC_LSFT, KC_TRNS, KC_TRNS, KC_TRNS, KC_TRNS, KC_TRNS, KC_HOME, KC_PGDN, KC_PGUP, KC_END,  KC_TRNS, KC_RSFT, KC_TRNS,
        KC_TRNS, KC_TRNS,                            KC_TRNS,                                                KC_TRNS, KC_TRNS),

    /* Layer 4: SpaceFN [Hold Space] - Function & Navigation
     ,* ,-----------------------------------------------------------.
     ,* |`  | F1| F2| F3| F4| F5| F6| F7| F8| F9|F10|F11|F12|Ins|Del|
     ,* |-----------------------------------------------------------|
     ,* |     |   |   |Esc|   |   |   |Hom|Up |End|PSc|SLk|Pau|     |
     ,* |-----------------------------------------------------------|
     ,* |      |   |   |   |   |   |PgU|Lef|Dow|Rig|   |   |        |
     ,* |-----------------------------------------------------------|
     ,* |        |   |   |   |   |Spc|PgD|   |   |   |   |      |   |
     ,* `-----------------------------------------------------------'
     ,*
     ,* Modern SpaceFN layer - Efficient function key access
     ,* Perfect blend of HHKB tradition and modern efficiency
     ,*/
    [SPACEF] = LAYOUT(
        KC_GRV,  KC_F1,   KC_F2,   KC_F3,   KC_F4,   KC_FKC_GRV,  KC_F1,   KC_F2,   KC_F3,   KC_F4,   KC_F5,   KC_F6,   KC_F7,   KC_F8,   KC_F9,   KC_F10,  KC_F11,  KC_F12,  KC_INS,  KC_DEL,
        KC_TRNS, KC_TRNS, KC_TRNS, KC_ESC,  KC_TRNS, KC_TRNS, KC_TRNS, KC_HOME, KC_UP,   KC_END,  KC_PSCR, KC_SCRL, KC_PAUS, KC_TRNS,
        KC_TRNS, KC_TRNS, KC_TRNS, KC_TRNS, KC_TRNS, KC_TRNS, KC_PGUP, KC_LEFT, KC_DOWN, KC_RGHT, KC_TRNS, KC_TRNS, KC_TRNS,
        KC_TRNS, KC_TRNS, KC_TRNS, KC_TRNS, KC_TRNS, KC_SPC,  KC_PGDN, KC_TRNS, KC_TRNS, KC_TRNS, KC_TRNS, KC_TRNS, KC_TRNS,
        KC_TRNS, KC_TRNS,                            KC_TRNS,                                                KC_TRNS, KC_TRNS)
};

/*
 ,* 🔧 Usage Guide 🔧
 ,* ================
 ,*
 ,* This keymap combines multiple powerful features:
 ,*
 ,* 1. Classic HHKB Layer (Always active)
 ,*    - Your familiar HHKB layout, untouched in its perfection
 ,*
 ,* 2. Mouse Control (Hold Semicolon)
 ,*    - Mouse movement: IJKL
 ,*    - Mouse buttons: M, <, >
 ,*    - Wheel: YUIO
 ,*    - Adjustable speed: ASD
 ,*
 ,* 3. VI Navigation (Hold Slash)
 ,*    - Cursor: HJKL (VI style)
 ,*    - Page Up/Down, Home/End easily accessible
 ,*    - Perfect for text editing and coding
 ,*
 ,* 4. SpaceFN Features (Hold Space)
 ,*    - F1-F12 keys in number row
 ,*    - Navigation cluster around IJKL
 ,*    - System keys (Print Screen, Scroll Lock, Pause)
 ,*
 ,* 5. Traditional Fn Layer (Fn Key)
 ,*    - Standard HHKB function layer
 ,*    - Media controls
 ,*    - Arrow keys
 ,*
 ,* 💫 Pro Tips:
 ,* - Use Mouse layer for precise pointer control
 ,* - VI layer is perfect for code navigation
 ,* - SpaceFN gives you lightning-fast access to F-keys
 ,* - Combine layers creatively for maximum efficiency
 ,*
 ,* Remember Wada-san's wisdom: mastery takes time, but the results are worth it.
 ,*
 ,* Happy Hacking! ⌨️
 ,*
 ,* Special thanks to Hasu for the original alternate controller
 ,* and his invaluable help in the geekhack forums.
 ,*
 ,* Version: 1.0
 ,* Author: Pascual Muñoz Galián
 ,* Source: https://github.com/pascualmg/hhkb-ultimate
 ,*
 ,* This keymap is shared with the community in the spirit of
 ,* open source and the HHKB philosophy. Feel free to modify
 ,* and improve upon it!
 ,*/

#+end_src